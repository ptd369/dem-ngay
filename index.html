<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>30 NgÃ y Thay Äá»•i Báº£n ThÃ¢n</title>
<style>
body { font-family: Arial; margin:0; padding:20px; background:var(--bg); color:var(--text);} 
:root { --bg:#fff; --text:#000; --accent:#4caf50;} 
.dark { --bg:#121212; --text:#fff; --accent:#81c784;} 
.task-list {max-width:350px; margin:auto; display:flex; flex-direction:column; gap:10px;} 
.task {padding:12px; border-radius:8px; background:rgba(0,0,0,0.15); cursor:pointer;} 
.task.completed {background:var(--accent); color:white;} 
textarea {width:90%; margin:15px auto; display:block; padding:10px; border-radius:6px;} 
h3 { margin-top:25px; }
</style>
</head>
<body>
<button class="toggle-mode">ğŸŒ™</button>
<h1>ğŸŒŸ 30 NgÃ y Thay Äá»•i Báº£n ThÃ¢n ğŸŒŸ</h1>
<h2 id="dayTitle"></h2>
<div id="date"></div>
<div id="countdown"></div>

<div class="task-list" id="taskList"></div>

<h3 id="doneMessage" style="text-align:center;color:var(--accent);"></h3>

<h3>ğŸ“ Káº¿ hoáº¡ch chi tiáº¿t hÃ´m nay</h3>
<textarea id="planBox"></textarea>

<script>
// ==============================
// INITIALIZE DATA
// ==============================
const tasks=["Táº­p thá»ƒ dá»¥c","Há»c bÃ i","Uá»‘ng sá»¯a","Táº¯t mÃ¡y tÃ­nh trÆ°á»›c 21:45","Äá»c sÃ¡ch"];
let now=new Date();
const todayKey=now.toDateString();

let data=JSON.parse(localStorage.getItem("progressData"))||{
  day:1,
  history:{},
  plans:{},
  lastDate:todayKey
};

if(!data.history) data.history={};
if(!data.plans) data.plans={};

// ==============================
// HANDLE DAY SWITCH
// ==============================
if(data.lastDate!==todayKey){
  const last=new Date(data.lastDate);
  const diff=(now-last)/86400000;

  if(diff>=1 && !data.history[data.lastDate]){
    alert("ğŸ˜¢ Báº¡n Ä‘Ã£ tháº¥t báº¡i! Reset láº¡i ngÃ y 1.");
    data.day=1;
    data.history={};
    data.plans={};
  }

  data.lastDate=todayKey;
  localStorage.setItem("progressData",JSON.stringify(data));
}

// ==============================
// RENDER BASIC INFO
// ==============================
document.getElementById("dayTitle").innerText=`NgÃ y ${data.day}/30`;
document.getElementById("date").innerText=now.toLocaleDateString("vi-VN");

loadTasks();
checkDailyCompletion();
loadPlans();
countdown();

// ==============================
// LOAD TASKS
// ==============================
function loadTasks(){
 const list=document.getElementById("taskList"); list.innerHTML="";
 let completed=JSON.parse(localStorage.getItem(todayKey))||[];
 if(!Array.isArray(completed)) completed=[];

 tasks.forEach(t=>{
   const div=document.createElement("div");
   div.className="task";
   div.innerText=t;
   if(completed.includes(t)) div.classList.add("completed");
   div.onclick=()=>toggle(t,div);
   list.appendChild(div);
 });
}

// ==============================
// TOGGLE TASK
// ==============================
function toggle(task,el){
 let completed=JSON.parse(localStorage.getItem(todayKey))||[];
 if(!Array.isArray(completed)) completed=[];

 if(completed.includes(task)){
   completed=completed.filter(x=>x!==task);
   el.classList.remove("completed");
 } else {
   completed.push(task);
   el.classList.add("completed");
 }
 localStorage.setItem(todayKey,JSON.stringify(completed));

 checkDailyCompletion();

 if(completed.length===tasks.length && !data.history[todayKey]){
   data.history[todayKey]=`HoÃ n thÃ nh ngÃ y ${data.day}`;
   data.day++;
   localStorage.setItem("progressData",JSON.stringify(data));
 }
}

// ==============================
// DAILY COMPLETION CHECK
// ==============================
function checkDailyCompletion(){
  let completed=JSON.parse(localStorage.getItem(todayKey))||[];
  const msgEl=document.getElementById("doneMessage");

  if(completed.length===tasks.length){
    msgEl.innerText="ğŸ‰ Báº¡n Ä‘Ã£ hoÃ n thÃ nh má»¥c tiÃªu hÃ´m nay!";
  } else {
    msgEl.innerText="";
  }
}

// ==============================
// PLANS
// ==============================
function loadPlans(){
 const box=document.getElementById("planBox");
 box.value=data.plans[todayKey]||"";
 box.oninput=()=>{
   data.plans[todayKey]=box.value;
   localStorage.setItem("progressData",JSON.stringify(data));
 };
}

// ==============================
// COUNTDOWN
// ==============================
function countdown(){
 const n=new Date();
 const midnight=new Date(); midnight.setHours(24,0,0,0);
 const diff=midnight-n;
 const h=Math.floor(diff/3600000), m=Math.floor((diff%3600000)/60000), s=Math.floor((diff%60000)/1000);
 document.getElementById("countdown").innerText=`â° CÃ²n láº¡i: ${h}h ${m}m ${s}s`;
 setTimeout(countdown,1000);
}

// ==============================
// DARK MODE
// ==============================
const toggleBtn=document.querySelector(".toggle-mode");
if(localStorage.getItem("theme")==="dark") document.body.classList.add("dark");
toggleBtn.onclick=()=>{
 document.body.classList.toggle("dark");
 localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"light");
};
</script>
</body>
</html>
